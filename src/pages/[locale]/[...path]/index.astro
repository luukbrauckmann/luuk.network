---
import { getCollection } from "astro:content";
import { BlogPost, OverviewPage, ProjectPage, RegularPage } from "@layouts";
import type { GetStaticPaths, InferGetStaticPropsType } from "astro";

export const getStaticPaths = (async () => {
  const pages = await getCollection("pages");

  return pages.map((page) => {
    const [locale, ...path] = page.id.split("/");
    const stringPath = path.join("/");
    return {
      params: { locale, path: stringPath.length > 0 ? stringPath : undefined },
      props: { page: page.data }
    };
  });
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { page } = Astro.props;

const layoutsByTypename = {
  BlogPostRecord: BlogPost,
  OverviewPageRecord: OverviewPage,
  ProjectPageRecord: ProjectPage,
  RegularPageRecord: RegularPage
};

const Layout = layoutsByTypename[page.content.__typename];
---

<Layout
  locale={page.locale}
  seo={page._seoMetaTags}
  menu={page.menu}
  page={page}
/>
